<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<link rel="stylesheet" href="./css/reset.css">
	<link rel="stylesheet" href="./css/tgybase.css">
</head>
<body>
	<section class="tg-container">
		<nav class="tg-header">
			<div class="tg-projects">
				示例项目
			</div>
			<ul class="clearfix">
				<li><a href="" class="tg-headNavActive">主页</a></li>
				<li><a href="">任务版</a></li>
				<li><a href="">分享墙</a></li>
			</ul>
		</nav>
		<article class="tg-main clearfix">
			<div class="tg-left">
				<div class="tg-left-header clearfix">
					<div class="tg-iconHead"></div>
					<ul class="tg-left-nav clearfix" id="tg-nav">
						<li date-item="ntask">
							<a>
								<i class="icon-task tgy-base-icon"></i>
								<span>新任务</span>
							</a>
						</li>
						<li date-item="nshare">
							<a>
								<i class="icon-books tgy-base-icon"></i>
								<span>新分享</span>
							</a>
						</li>
						<li date-item="ndate">
							<a>
								<i class="icon-earth tgy-base-icon"></i>
								<span>新日程</span>
							</a>
						</li>
						<li date-item="nfile">
							<a>
								<i class="icon-word tgy-base-icon"></i>
								<span>新文件</span>
							</a>
						</li>
					</ul>
				</div>
				<div class="tg-left-lists">
					<ul class="tg-items" date-time="2015/6/2">
						<li class="tg-li-root">
							<h4>今日动态</h4>
						</li>
						<!--循环插入节点，参照根结点插入-->
						<li class="tg-li-ch"><span class="tg-sm-head"><img src="./image/person.jpg" alt=""></span><span class="tg-sm-name"><span>CaelumTian </span>创建了任务</span><span class="tg-sm-task"><i class="icon-task"></i>完成今天的任务就可以了</span><span class="tg-sm-time">13:48</span></li>
					</ul>
					<!--ul测试部分-->
							<ul class="tg-items" date-time="2015/6/2">
							<li class="tg-li-root">
							<h4>今日动态</h4>
							</li>
							<!--循环插入节点，参照根结点插入-->
							<li class="tg-li-ch">
							<span class="tg-sm-head">
								<img src="./image/person.jpg" alt="">
							</span>
							<span class="tg-sm-name">
								<span>CaelumTian </span>
								创建了任务
							</span>
							<span class="tg-sm-task">
								<i class="icon-task"></i>
								完成今天的任务就可以了
							</span>
							<span class="tg-sm-time">13:48</span>
							</li>
							<!--测试部分，可以删除 -->
							<li class="tg-li-ch">
							<span class="tg-sm-head">
								<img src="./image/person.jpg" alt="">
							</span>
							<span class="tg-sm-name">
								<span>CaelumTian </span>
								创建了任务
							</span>
							<span class="tg-sm-task">
								<i class="icon-task"></i>
								完成今天的任务就可以了
							</span>
							<span class="tg-sm-time">13:48</span>
							</li>
							<li class="tg-li-ch">
							<span class="tg-sm-head">
								<img src="./image/person.jpg" alt="">
							</span>
							<span class="tg-sm-name">
								<span>CaelumTian </span>
								创建了任务
							</span>
							<span class="tg-sm-task">
								<i class="icon-task"></i>
								完成今天的任务就可以了
							</span>
							<span class="tg-sm-time">13:48</span>
							</li>
							<!-- -->
							</ul>
					<!-- -->
				</div>
			</div>
			<div class="tg-right">
				<div class="tg-r-task">
					<header class="tg-r-head">
						项目任务统计
					</header>
					<ul class="tg-r-total clearfix"> 
						<li>
							<span class="tg-r-title1">任务总数</span>
							<span class="tg-r-num">10</span>
						</li>
						<li>
							<span class="tg-r-title1">已完成任务</span>
							<span class="tg-r-num2">5</span>
						</li>
						<li>
							<span class="tg-r-title1">待完成任务</span>
							<span class="tg-r-num3">12</span>
						</li>
					</ul>
				</div>
				<div class="tg-r-form">
					<header class="tg-r-head">
						最近任务进展
					</header>
					<div id="tg-form" style="height:200px;width:365px;">
						
					</div>
				</div>
			</div>
		</article>
	</section>

	<!--   悬浮层代码 -->
	<div id="dimmer" style="display:none;">
		<div id="tg-create-task">
			<header class="tg-dim-head clearfix">
				<span class="tg-dim-title">创建新任务</span>
				<i class="icon-cross tg-dim-cross" id="tgyCross"></i>
			</header>
			<section class="tg-dim-main">
				<textarea name="" id="tg-taskContent" placeholder="任务信息"></textarea>
				<div class="tg-dim-pic">
					<ul class="clearfix">
						<li>
							<h6>执行者</h6>
							<div class="tg-pic-main">
								<span class="tg-sm-head tg-floatBlock">
									<img src="./image/person.jpg" alt="">
								</span>
								<span class="tg-pic-name">
									CaelumTian
								</span>
							</div>
						</li>
						<li>
							<h6>选择截止时间</h6>
							<div class="tg-pic-main">
								<input type="date">
							</div>
						</li>
						<li id="tg-important">
							<h6>优先级</h6>
							<div class="tg-pic-main">
								<span id="tg-pic-yx">普通</span>
								<ul>
									<li>
										<span class="tg-check" style="color:rgb(56, 56, 56);" id="resetImp">普通</span>
									</li>
									<li>
										<span style="color:#ff9800;">紧急</span>
									</li>
									<li>
										<span style="color:#ff0000;">非常紧急</span>
									</li>
								</ul>
							</div>
						</li>
						<li>
							<h6>重复</h6>
							<div class="tg-pic-main">
								不重复
							</div>
						</li>
					</ul>
				</div>
			</section>
			<footer class="tg-dim-footer clearfix">
				<button id="tg-do-create">创建</button>	
			</footer>
		</div>
	</div>
	
	<script src="./js/tgyBase.js"></script>
	<script src="./js/echarts-all.js"></script>
	<script>
		/*
		 *  提供全局变量，用于表示任务执行状态
		 */
		window.tgy = {

		}   
		window.tgy.state = "创建了任务";    //应该是动态修改
		/************对外提供接口*************/
		window.tgy.insertTask = function(state) {
			var resetImp = document.getElementById("resetImp");
			var rootul = document.getElementsByClassName("tg-items")[0];
			var rootli = rootul.getElementsByClassName("tg-li-ch")[0];   //应该循环创建
			var date = new Date();
			var insertNode = document.createElement("li");
			insertNode.className = "tg-li-ch";
			var tempText = '<span class="tg-sm-head"><img src="./image/person.jpg" alt=""></span><span class="tg-sm-name"><span>CaelumTian </span>{0}</span><span class="tg-sm-task"><i class="icon-task"></i>{1}</span><span class="tg-sm-time">{2}</span>';
			insertNode.innerHTML = format(tempText, window.tgy.state, value1, date.getHours()+":"+date.getMinutes());
			afterInsert(rootul, rootli, insertNode);
			//这里应该加入回调函数
			document.getElementsByTagName("textarea")[0].value = "";
			document.querySelectorAll("input[type=date]")[0].value = "";
			resetImp.click();
		}
		Caelum.Event.addHandler(document, "DOMContentLoaded", function() {
			document.body.onselectstart = 'false';		//页面元素不能选中
			var tgNav = document.getElementById("tg-nav"),
				Event = Caelum.Event,
				dimmer = document.getElementById("dimmer"),
				taskPic = document.getElementById("tg-create-task"),
				taskCross = document.getElementById("tgyCross"),
				doCreate = document.getElementById("tg-do-create"),
				taskIm = document.getElementById("tg-pic-yx"),
				taskImpor = document.getElementById("tg-important"),
				imUl = document.querySelector(".tg-pic-main ul"),
				imSpan = imUl.getElementsByTagName("span"),
				resetImp = document.getElementById("resetImp");
			/*************事件优先级别选择****************/	
			Event.addHandler(taskImpor, "click", function(event) {
				var event = Event.getEvent(event),
					target = Event.getTarget(event);
				if(target.nodeName.toLowerCase() !== "span") {
					target = target.children[0];
				}
				for(var i = 0, j = imSpan.length; i < j; i++) {
					removeClass(imSpan[i], "tg-check");
				}
				addClass(target, "tg-check");
				taskIm.innerHTML = target.firstChild.nodeValue;
				taskIm.style.color = target.style.color;
			})
			/****************nav选择，弹出dimmer************************/
			Event.addHandler(tgNav, "click", function(event){
				var event = Event.getEvent(event),
					target = Event.getTarget(event);
				//循环找到li节点
				while(target.nodeName.toLowerCase() !== "li") {
					target = target.parentElement;
				}
				console.log(target.getAttribute("date-item"));
				runDimmer(target.getAttribute("date-item"));
			})
			Event.addHandler(taskCross, "click", function(event){
				var event = Event.getEvent(event);
				Event.stopPropagation(event);    //取消冒泡
				_afterDimmer();
			})
			/*************插入节点****************/
			Event.addHandler(doCreate, "click", function(event){
				var event = Event.getEvent(event);
				Event.stopPropagation(event);    //取消冒泡
				var value1 = document.getElementsByTagName("textarea")[0].value,
					value2 = document.querySelectorAll("input[type=date]")[0].value
					value3 = taskIm.firstChild.nodeValue;   //截止时间
				console.log(value1 + " " + value2 + " " + value3);
				if(value1.length < 1 || value2.length < 1) {
					return;
				}else {
					var rootul = document.getElementsByClassName("tg-items")[0];
					var rootli = rootul.getElementsByClassName("tg-li-ch")[0];   //应该循环创建
					var date = new Date();
					var insertNode = document.createElement("li");
					insertNode.className = "tg-li-ch";
					var tempText = '<span class="tg-sm-head"><img src="./image/person.jpg" alt=""></span><span class="tg-sm-name"><span>CaelumTian </span>{0}</span><span class="tg-sm-task"><i class="icon-task"></i>{1}</span><span class="tg-sm-time">{2}</span>';
					insertNode.innerHTML = format(tempText, window.tgy.state, value1, date.getHours()+":"+date.getMinutes());
					afterInsert(rootul, rootli, insertNode);
					//这里应该加入回调函数
					document.getElementsByTagName("textarea")[0].value = "";
					document.querySelectorAll("input[type=date]")[0].value = "";
					resetImp.click();
					_afterDimmer();
				}
			})
			/*
			 *  根据传过来的标志，决定弹出哪个项目
			 */
			function runDimmer(itemType) {
				_beforeDimmer();
			}
			//弹出层前置后置操作
			function _beforeDimmer() {
				dimmer.style.display = "block";
				setTimeout(function(){
					addClass(taskPic,"tg-create-task-active");
				}, 0)
				//addClass(.tg-create-task-active)
			}
			function _afterDimmer() {
				removeClass(taskPic,"tg-create-task-active");
				setTimeout(function(){
					dimmer.style.display = "none";
				}, 600)
			}
		})
		var myChart = echarts.init(document.getElementById('tg-form')); 
        var option = {
            tooltip: {
                show: false
            },
            grid: {
        		borderWidth: 0,
        		x:40,
       		 	y: 20,
       		 	width:280,
    		},
            xAxis : [
                {
                    type : 'category',
                    data : [
                    	"05/29","05/30","05/31","06/01","06/02","06/03"
                    ],
                }
            ],
            yAxis : [
                {
                    type : 'value'
                }
            ],
            series : [
                {
                    "name":"销量",
                    "type":"bar",
                    itemStyle: {
                        normal: {
                            color: function(params) {
                                // build a color map as your need.
                                var colorList = [
                                  '#C1232B','#5B6E02','#0171B5','#E87C25','#27727B',
                                   '#FE8463'
                                ];
                                return colorList[params.dataIndex]
                            },
                        }
                    },
                    "data":[5, 20, 40, 10, 10,10,10]
                }
            ]
        };
        // 为echarts对象加载数据 
        myChart.setOption(option); 
	</script>
</body>
</html>